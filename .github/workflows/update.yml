name: Build and Deploy Exam Project

on:
  push:
    branches:
      - master  # Ensure this is the correct branch
  workflow_dispatch:  # Allow manual trigger with inputs
    inputs:
      examName:
        required: true
        default: 'sc-300'  # Default value (optional)

jobs:
  build-and-deploy:
    runs-on: windows-latest  # Run on Windows for PowerShell

    steps:
    # Step 1: Checkout the repository
    - name: Checkout code
      uses: actions/checkout@v2

    # Step 2: Set up Node.js environment (Ensure Node.js 14 or higher is installed)
    - name: Set up Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '20.12.0'  # Specify Node.js version 14 or later to support `??=`

    # Step 3: Install Node.js dependencies
    - name: Install Node.js dependencies
      run: |
        npm install express puppeteer cheerio axios  # Include any other dependencies

    # Step 4: Install Python dependencies (if any)
    - name: Install Python dependencies
      run: |
        # Ensure Python is available
        python --version

    # Step 5: Pass exam name as environment variable to Python script
    - name: Run Python script
      run: |
        $env:EXAM_NAME = "${{ github.event.inputs.examName }}"
        python ./main.py

    # Step 6: Run the PowerShell script with the user-defined examName
    - name: Run PowerShell script
      run: |
        # Pass the examName input from the GitHub Actions workflow to PowerShell
        $env:examName = "${{ github.event.inputs.examName }}"  # Get the examName input
        ./start.ps1

    # Step 7: Commit the changes with the message "added {examName}"
    - name: Commit changes
      run: |
        git config user.name "GitHub Actions"
        git config user.email "actions@github.com"
        git add .
        git commit -m "Updated ${EXAM_NAME}" || echo "No changes to commit"
        git push origin master  # Ensure you're pushing to the correct branch
